# E-Commerce 서비스 부하 테스트 결과 보고서

**문서 버전**: v1.0
**테스트 일자**: 2026-02-26
**작성자**: 백엔드 개발팀

---

## 1. 테스트 환경

### 1.1 테스트 도구
- **부하 생성 도구**: K6 (버전: 확인 필요)
- **모니터링**: Docker Stats, K6 내장 메트릭

### 1.2 테스트 대상 서버
```
- 애플리케이션: Spring Boot 3.4.1
- JDK: Java 17
- 데이터베이스: MySQL 8.0 (Docker)
- 캐시: Redis 7-alpine (Docker)
- 메시지 브로커: Kafka 7.5.0 (Docker)
```

### 1.3 테스트 환경 구성
```yaml
# Docker 리소스 설정
Application:
  CPU: 1.0 Core (기본)
  Memory: 1GB

MySQL:
  CPU: 0.5 Core
  Memory: 512MB

Redis:
  CPU: 0.25 Core
  Memory: 256MB
```

---

## 2. 테스트 실행 가이드

### 2.1 사전 준비

#### K6 설치 (Windows)
```powershell
# Chocolatey를 사용한 설치
choco install k6

# 또는 직접 다운로드
# https://dl.k6.io/msi/k6-latest-amd64.msi
```

#### Docker 환경 시작
```bash
# 프로젝트 루트에서 실행
cd C:\Users\kss10\IdeaProjects\hangae\hh_plus_scenario

# Docker 컨테이너 시작
docker-compose up -d

# 컨테이너 상태 확인
docker ps
```

#### 애플리케이션 시작
```bash
# Gradle을 사용한 실행
./gradlew bootRun

# 또는 JAR 실행
./gradlew build
java -jar build/libs/server-0.0.1-SNAPSHOT.jar
```

### 2.2 테스트 실행

#### 결과 저장 디렉터리 생성
```bash
mkdir -p docs/ch10/k6-scripts/results
```

#### Smoke Test 실행
```bash
cd docs/ch10/k6-scripts
k6 run smoke_test.js
```

#### Load Test 실행
```bash
k6 run load_test.js
k6 run --out json=results/load_result.json load_test.js
```

#### Stress Test 실행
```bash
k6 run stress_test.js
k6 run --out json=results/stress_result.json stress_test.js
```

#### 시나리오별 테스트 실행
```bash
# 포인트 충전 동시성 테스트
k6 run scenario_point_charge.js

# 선착순 쿠폰 발급 테스트
k6 run scenario_coupon_issue.js

# 주문-결제 통합 테스트
k6 run scenario_order_payment.js
```

---

## 3. 테스트 결과

> **참고**: 아래 결과는 테스트 실행 후 수집된 데이터로 업데이트해야 합니다.

### 3.1 Smoke Test 결과

| 지표 | 결과 | 목표 | 상태 |
|------|------|------|------|
| 총 요청 수 | 302 | - | - |
| 성공률 | 20% | > 99% | ❌ 실패 |
| 평균 응답 시간 | 22.34ms | < 500ms | ✅ 달성 |
| p95 응답 시간 | 61.08ms | < 2000ms | ✅ 달성 |
| 에러율 | 79.80% | < 1% | ❌ 미달 |

**분석**:
- 회원 생성 API 응답 파싱 문제로 memberId가 undefined로 설정됨
- 인기 상품 조회 API만 100% 성공
- 응답 시간은 목표 달성 (p95=61.08ms < 2000ms)

**테스트 출력**:
```
K6 v1.6.1 Smoke Test (3 VUs, 1분)

HTTP Metrics:
- http_req_duration: avg=22.34ms, med=6.44ms, p95=61.08ms
- http_req_failed: 79.80%
- http_reqs: 302 (4.8/s)

Checks:
- 인기 상품 조회 성공: ✓ 60/60 (100%)
- 포인트 조회 성공: ✗ 0/60 (0%)
- 포인트 충전 성공: ✗ 0/60 (0%)
- 상품 조회 성공: ✗ 0/60 (0%)
- 재고 조회 성공: ✗ 0/60 (0%)

총 반복: 60회
```

### 3.2 Load Test 결과

#### 단계별 성능 측정

| 단계 | VUs | 지속시간 | TPS | p50 | p95 | p99 | 에러율 |
|------|-----|---------|-----|-----|-----|-----|-------|
| 워밍업 | 10 | 30s | - | - | - | - | - |
| 일반 부하 | 50 | 1m | - | - | - | - | - |
| 피크 부하 | 100 | 2m | - | - | - | - | - |
| 부하 감소 | 50 | 1m | - | - | - | - | - |
| 쿨다운 | 10 | 30s | - | - | - | - | - |

**API별 응답 시간**:

| API | 요청 수 | p50 | p95 | p99 | 에러율 |
|-----|--------|-----|-----|-----|-------|
| GET /api/product/{id} | - | - | - | - | - |
| GET /api/product/popular | - | - | - | - | - |
| POST /api/point/charge | - | - | - | - | - |
| GET /api/point/{id} | - | - | - | - | - |
| POST /api/order | - | - | - | - | - |

**테스트 출력**:
```
[실행 결과를 여기에 붙여넣기]
```

### 3.3 Stress Test 결과

#### Breaking Point 분석

| VUs | TPS | p95 응답시간 | 에러율 | 상태 |
|-----|-----|------------|-------|------|
| 50 | - | - | - | - |
| 100 | - | - | - | - |
| 200 | - | - | - | - |
| 300 | - | - | - | - |
| 400 | - | - | - | - |
| 500 | - | - | - | - |

**Breaking Point**: VUs = - (에러율이 급증하는 지점)

**테스트 출력**:
```
[실행 결과를 여기에 붙여넣기]
```

### 3.4 포인트 충전 동시성 테스트 결과

#### 시나리오 1: 동일 사용자 동시 충전 (100 VUs)

| 지표 | 결과 | 기대값 | 상태 |
|------|------|-------|------|
| 총 요청 수 | - | 100 | - |
| 성공한 충전 | - | 100 | - |
| 실패한 충전 | - | 0 | - |
| 초기 포인트 | - | 0 | - |
| 최종 포인트 | - | 100,000 | - |
| 데이터 정합성 | - | 100% | - |

**Lock 대기 시간 분석**:
- p50: - ms
- p95: - ms
- p99: - ms

**테스트 출력**:
```
[실행 결과를 여기에 붙여넣기]
```

### 3.5 선착순 쿠폰 발급 테스트 결과

#### 시나리오 1: 100명 동시 발급 (수량: 10개)

| 지표 | 결과 | 기대값 | 상태 |
|------|------|-------|------|
| 총 요청 수 | - | 100 | - |
| 성공한 발급 | - | 10 | - |
| 실패한 발급 (수량 초과) | - | 90 | - |
| 중복 발급 | - | 0 | - |
| 초과 발급 (oversell) | - | 0 | - |

**테스트 출력**:
```
[실행 결과를 여기에 붙여넣기]
```

### 3.6 주문-결제 통합 테스트 결과

#### 전체 구매 흐름 (E2E)

| 지표 | 결과 | 목표 | 상태 |
|------|------|------|------|
| 총 구매 시도 | - | - | - |
| 성공한 주문 | - | - | - |
| 성공한 결제 | - | - | - |
| E2E p50 | - | < 2000ms | - |
| E2E p95 | - | < 5000ms | - |

#### 재고 경쟁 테스트 (100명 → 50개 재고)

| 지표 | 결과 | 기대값 | 상태 |
|------|------|-------|------|
| 성공한 주문 | - | <= 50 | - |
| 초과 판매 | - | 0 | - |

**테스트 출력**:
```
[실행 결과를 여기에 붙여넣기]
```

---

## 4. 리소스 사용량 분석

### 4.1 애플리케이션 리소스

| 테스트 | CPU 사용률 | Memory 사용률 | 비고 |
|--------|-----------|--------------|------|
| Smoke Test | - | - | - |
| Load Test (피크) | - | - | - |
| Stress Test (최대) | - | - | - |

### 4.2 데이터베이스 리소스

| 테스트 | 연결 수 | CPU | Memory | 비고 |
|--------|--------|-----|--------|------|
| Smoke Test | - | - | - | - |
| Load Test (피크) | - | - | - | - |
| Stress Test (최대) | - | - | - | - |

### 4.3 Redis 리소스

| 테스트 | 연결 수 | Memory | 명령 처리량 | 비고 |
|--------|--------|--------|-----------|------|
| Smoke Test | - | - | - | - |
| Load Test (피크) | - | - | - | - |
| Stress Test (최대) | - | - | - | - |

---

## 5. 리소스 제한 테스트 결과

### 5.1 테스트 매트릭스

동일한 Load Test를 다양한 리소스 설정으로 실행한 결과:

| 설정 ID | CPU | Memory | 최대 TPS | p95 응답시간 | 에러율 | 권장 |
|---------|-----|--------|---------|------------|-------|------|
| R1 | 0.5 Core | 512MB | - | - | - | - |
| R2 | 1.0 Core | 1GB | - | - | - | - |
| R3 | 2.0 Core | 2GB | - | - | - | - |

### 5.2 권장 배포 스펙

테스트 결과를 바탕으로 권장하는 배포 스펙:

```yaml
# 권장 리소스 설정 (예상)
Production:
  replicas: 2-3
  resources:
    requests:
      cpu: "1.0"
      memory: "1Gi"
    limits:
      cpu: "2.0"
      memory: "2Gi"
```

---

## 6. 병목 지점 분석

### 6.1 식별된 병목 지점

| 순위 | 위치 | 증상 | 원인 | 권장 개선안 |
|------|------|------|------|-----------|
| 1 | - | - | - | - |
| 2 | - | - | - | - |
| 3 | - | - | - | - |

### 6.2 상세 분석

#### 병목 지점 1: (테스트 후 작성)
- **증상**:
- **원인 분석**:
- **개선 방안**:

---

## 7. 성능 목표 달성 여부

### 7.1 SLA 달성 현황

| 지표 | 목표 | 실측 | 달성 여부 |
|------|------|------|---------|
| 조회 API p95 | < 200ms | - | - |
| 쓰기 API p95 | < 500ms | - | - |
| 복합 트랜잭션 p95 | < 1초 | - | - |
| 에러율 | < 1% | - | - |
| 데이터 정합성 | 100% | - | - |

### 7.2 개선 필요 항목

| 항목 | 현재 | 목표 | Gap | 우선순위 |
|------|------|------|-----|---------|
| - | - | - | - | - |

---

## 8. 결론 및 권고사항

### 8.1 주요 발견사항

1. **성능 기준선**
   - 최대 처리 가능 TPS: -
   - 안정적 운영 가능 VUs: -

2. **동시성 제어 검증**
   - 포인트 충전: (Redisson 분산락 동작 여부)
   - 쿠폰 발급: (Pessimistic Lock 동작 여부)
   - 재고 차감: (동시성 제어 동작 여부)

3. **Breaking Point**
   - VUs: - 에서 시스템 한계 도달
   - 주요 원인: -

### 8.2 권고사항

#### 단기 개선 (즉시 적용 가능)
- [ ] -
- [ ] -

#### 중기 개선 (계획 필요)
- [ ] -
- [ ] -

#### 장기 개선 (아키텍처 변경)
- [ ] -
- [ ] -

---

## 9. 첨부 자료

### 9.1 테스트 스크립트 위치
```
docs/ch10/k6-scripts/
├── smoke_test.js
├── load_test.js
├── stress_test.js
├── scenario_point_charge.js
├── scenario_coupon_issue.js
└── scenario_order_payment.js
```

### 9.2 결과 데이터 위치
```
docs/ch10/k6-scripts/results/
├── smoke_result.json
├── load_result.json
├── stress_result.json
├── point_charge_summary.json
├── coupon_issue_summary.json
└── order_payment_summary.json
```

---

## 10. 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|-------|----------|
| v1.0 | 2026-02-26 | 백엔드 개발팀 | 초안 작성 (템플릿) |
| | | | 테스트 실행 후 결과 업데이트 필요 |

---

**문서 끝**
