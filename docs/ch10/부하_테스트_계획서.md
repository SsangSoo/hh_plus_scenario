# E-Commerce 서비스 부하 테스트 계획서

**문서 버전**: v1.0
**작성일**: 2026-02-26
**작성자**: 백엔드 개발팀

---

## 1. 개요

### 1.1 배경

현재 e-commerce 서비스는 회원 관리, 상품 조회, 포인트 관리, 주문/결제, 선착순 쿠폰 발급 등 핵심 비즈니스 기능을 제공하고 있습니다. 서비스 오픈 전 시스템의 안정성과 성능 한계를 파악하여, 실제 운영 환경에서 발생할 수 있는 문제를 사전에 예방하고자 부하 테스트를 계획하였습니다.

### 1.2 목적

| 목적 | 설명 |
|------|------|
| **성능 기준선 수립** | 현재 시스템의 처리 능력(TPS, Latency) 측정 |
| **한계점 파악** | 시스템이 감당할 수 있는 최대 동시 사용자 수 식별 |
| **병목 지점 발견** | CPU, 메모리, DB, Redis 등 리소스 병목 구간 파악 |
| **동시성 검증** | 분산락, Pessimistic Lock 등 동시성 제어 메커니즘 검증 |
| **배포 스펙 도출** | 적절한 서버 리소스(CPU/Memory) 사양 결정 |

### 1.3 기대 효과

- 서비스 오픈 전 잠재적 장애 요소 사전 제거
- 운영팀에 명확한 용량 계획(Capacity Planning) 정보 제공
- SLA(Service Level Agreement) 기준 수립을 위한 데이터 확보

---

## 2. 테스트 대상 선정

### 2.1 선정 기준

| 기준 | 설명 |
|------|------|
| **높은 트래픽 예상** | 사용자가 자주 호출하는 API |
| **동시성 민감도** | 경쟁 조건(Race Condition)이 발생할 수 있는 API |
| **비즈니스 중요도** | 매출과 직결되는 핵심 비즈니스 로직 |
| **외부 의존성** | Redis, Kafka 등 외부 시스템 연동 API |

### 2.2 테스트 대상 API

#### 핵심 테스트 대상 (우선순위 높음)

| 순위 | API | 엔드포인트 | 선정 이유 |
|------|-----|----------|----------|
| 1 | 포인트 충전 | `POST /api/point/charge` | Redisson 분산락 적용, 동시성 이슈 민감 |
| 2 | 쿠폰 발급 | `POST /api/coupon/issue` | 선착순 발급, Pessimistic Lock 적용 |
| 3 | 결제 처리 | `POST /api/pay` | Redis 멱등성 키, 핵심 비즈니스 |
| 4 | 주문 생성 | `POST /api/order` | 재고 차감, 복합 트랜잭션 |

#### 조회 API (부가 테스트)

| API | 엔드포인트 | 선정 이유 |
|-----|----------|----------|
| 상품 조회 | `GET /api/product/{productId}` | 높은 호출 빈도 예상 |
| 인기 상품 조회 | `GET /api/product/popular` | 복잡한 쿼리, 캐싱 필요 여부 검토 |
| 포인트 조회 | `GET /api/point/{memberId}` | 기본 조회 성능 기준 |
| 재고 조회 | `GET /api/stock/{productId}` | 실시간 재고 확인 빈도 높음 |

### 2.3 테스트 제외 대상

| API | 제외 이유 |
|-----|----------|
| 회원 가입 | 일회성 호출, 트래픽 부담 낮음 |
| 쿠폰 생성 | 관리자 기능, 호출 빈도 낮음 |
| 상품 등록 | 관리자 기능, 호출 빈도 낮음 |
| 재고 추가 | 관리자 기능, 호출 빈도 낮음 |

---

## 3. 테스트 시나리오

### 3.1 테스트 유형

| 유형 | 목적 | VUs | 지속 시간 |
|------|------|-----|----------|
| **Smoke Test** | 기본 동작 확인 | 1-5 | 1분 |
| **Load Test** | 예상 트래픽 부하 | 50-100 | 5분 |
| **Stress Test** | 한계점 탐색 | 100-500 | 10분 |
| **Spike Test** | 순간 급증 대응 | 0→500→0 | 5분 |
| **Soak Test** | 장시간 안정성 | 50 | 30분 |

### 3.2 시나리오별 상세 설계

#### 시나리오 1: 포인트 충전 동시성 테스트

```
목적: Redisson 분산락의 동시성 제어 능력 검증
대상 API: POST /api/point/charge
테스트 흐름:
  1. 동일 사용자(memberId=1)에 대해 100개 동시 요청
  2. 각 요청당 1,000 포인트 충전
  3. 최종 포인트 = 초기값 + (성공 요청 수 × 1,000)

성공 기준:
  - 데이터 정합성: 최종 포인트 = 계산값
  - 에러율: < 1%
  - p99 Latency: < 2초
```

#### 시나리오 2: 선착순 쿠폰 발급 테스트

```
목적: 제한된 수량의 쿠폰 발급 시 동시성 제어 검증
대상 API: POST /api/coupon/issue
테스트 흐름:
  1. 수량 10개인 쿠폰 생성
  2. 100명의 서로 다른 사용자가 동시에 발급 요청
  3. 정확히 10명만 발급 성공 확인

성공 기준:
  - 발급 수량: 정확히 10개
  - 초과 발급: 0건
  - 중복 발급: 0건
```

#### 시나리오 3: 주문-결제 통합 시나리오

```
목적: 실제 사용자 행동 패턴 시뮬레이션
대상 API:
  - GET /api/product/{productId}
  - POST /api/order
  - POST /api/pay

테스트 흐름:
  1. 상품 조회 (Think Time: 1-3초)
  2. 주문 생성 (Think Time: 0.5-1초)
  3. 결제 처리
  4. 반복

성공 기준:
  - 전체 흐름 성공률: > 99%
  - 평균 응답 시간: < 1초
```

#### 시나리오 4: 인기 상품 조회 부하

```
목적: 읽기 집중 트래픽 처리 능력 검증
대상 API: GET /api/product/popular
테스트 흐름:
  1. 500 VUs로 지속적 조회 요청
  2. 캐시 효과 측정 (있는 경우)

성공 기준:
  - TPS: > 500
  - p95 Latency: < 500ms
```

---

## 4. 성능 목표 (SLA 기준)

### 4.1 응답 시간 목표

| 구분 | p50 | p95 | p99 | Max |
|------|-----|-----|-----|-----|
| 조회 API | < 100ms | < 200ms | < 500ms | < 1초 |
| 쓰기 API | < 200ms | < 500ms | < 1초 | < 2초 |
| 복합 트랜잭션 | < 500ms | < 1초 | < 2초 | < 5초 |

### 4.2 처리량 목표

| API 유형 | 목표 TPS |
|---------|---------|
| 조회 API | > 500 TPS |
| 포인트 충전 | > 100 TPS |
| 쿠폰 발급 | > 50 TPS |
| 주문/결제 | > 100 TPS |

### 4.3 안정성 목표

| 지표 | 목표 |
|------|------|
| 에러율 | < 1% |
| 가용성 | > 99.9% |
| 데이터 정합성 | 100% |

---

## 5. 테스트 환경

### 5.1 인프라 구성

```
┌─────────────────────────────────────────────────────────────┐
│                    로컬 테스트 환경                           │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│   ┌─────────┐      ┌─────────────────────────────────────┐ │
│   │   K6    │ ───▶ │     Spring Boot Application         │ │
│   │ (부하   │      │  ┌─────────────────────────────┐   │ │
│   │  생성기) │      │  │ CPU: 1-2 Core               │   │ │
│   └─────────┘      │  │ Memory: 1-2 GB              │   │ │
│                    │  │ JVM Heap: 512MB-1GB         │   │ │
│                    │  └─────────────────────────────┘   │ │
│                    └────────────┬────────────────────────┘ │
│                                 │                           │
│            ┌────────────────────┼────────────────────┐     │
│            │                    │                    │     │
│            ▼                    ▼                    ▼     │
│     ┌───────────┐       ┌───────────┐       ┌───────────┐ │
│     │   MySQL   │       │   Redis   │       │   Kafka   │ │
│     │   8.0     │       │  7-alpine │       │   7.5.0   │ │
│     │ Port:3306 │       │ Port:6379 │       │ Port:9092 │ │
│     └───────────┘       └───────────┘       └───────────┘ │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 Docker Compose 리소스 설정

```yaml
# 기본 설정 (테스트 시작점)
services:
  app:
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
```

### 5.3 리소스 제한 테스트 매트릭스

| 테스트 ID | CPU | Memory | 예상 TPS | 비고 |
|----------|-----|--------|---------|------|
| R1 | 0.5 Core | 512MB | 낮음 | 최소 스펙 |
| R2 | 1.0 Core | 1GB | 중간 | 기본 스펙 |
| R3 | 2.0 Core | 2GB | 높음 | 고성능 스펙 |

---

## 6. 테스트 도구

### 6.1 K6 선정 이유

| 특징 | 설명 |
|------|------|
| **JavaScript 기반** | 개발자 친화적, 학습 곡선 낮음 |
| **경량화** | Go 언어로 작성, 낮은 리소스 사용 |
| **CLI 기반** | CI/CD 파이프라인 통합 용이 |
| **실시간 메트릭** | 테스트 중 실시간 결과 확인 가능 |
| **무료 오픈소스** | 비용 절감 |

### 6.2 설치 방법

```bash
# Windows (Chocolatey)
choco install k6

# Windows (MSI 설치)
# https://dl.k6.io/msi/k6-latest-amd64.msi

# macOS
brew install k6

# Linux
sudo apt install k6
```

### 6.3 실행 명령어 예시

```bash
# 기본 실행
k6 run script.js

# JSON 결과 출력
k6 run --out json=results.json script.js

# VUs 및 지속 시간 오버라이드
k6 run --vus 100 --duration 5m script.js
```

---

## 7. 모니터링 항목

### 7.1 애플리케이션 레벨

| 항목 | 수집 방법 | 임계값 |
|------|----------|-------|
| 응답 시간 (p50, p95, p99) | K6 | 목표치 참조 |
| 에러율 | K6 | < 1% |
| TPS | K6 | API별 목표치 |

### 7.2 인프라 레벨

| 항목 | 수집 방법 | 임계값 |
|------|----------|-------|
| CPU 사용률 | Docker stats | < 80% |
| Memory 사용률 | Docker stats | < 85% |
| DB 연결 수 | MySQL show processlist | < max_connections × 0.8 |
| Redis 메모리 | redis-cli INFO | < maxmemory × 0.8 |

### 7.3 모니터링 명령어

```bash
# Docker 리소스 모니터링
docker stats --format "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}"

# MySQL 연결 확인
docker exec hhplus-mysql mysql -uroot -proot -e "SHOW PROCESSLIST;"

# Redis 상태 확인
docker exec hhplus-redis redis-cli INFO memory
```

---

## 8. 테스트 실행 절차

### 8.1 사전 준비

```bash
# 1. Docker 인프라 구동
docker-compose up -d

# 2. 인프라 상태 확인
docker ps

# 3. 애플리케이션 빌드 및 실행
./gradlew bootRun

# 4. 헬스체크
curl http://localhost:8080/actuator/health

# 5. 테스트 데이터 준비 (회원, 상품, 재고 등)
```

### 8.2 테스트 실행 순서

```
1단계: Smoke Test
├── 목적: 시스템 정상 동작 확인
├── 실행: k6 run smoke_test.js
└── 소요: 1분

2단계: Load Test
├── 목적: 예상 트래픽 처리 능력 확인
├── 실행: k6 run load_test.js
└── 소요: 5분

3단계: Stress Test
├── 목적: 시스템 한계점 파악
├── 실행: k6 run stress_test.js
└── 소요: 10분

4단계: 시나리오별 테스트
├── 포인트 충전: k6 run scenario_point_charge.js
├── 쿠폰 발급: k6 run scenario_coupon_issue.js
└── 주문/결제: k6 run scenario_order_payment.js
```

### 8.3 리소스 제한 테스트

```bash
# 리소스 제한 적용 후 재시작
docker-compose down
docker-compose -f docker-compose.test.yml up -d

# 각 리소스 설정별로 Load Test 반복
k6 run load_test.js
```

---

## 9. 리스크 및 대응 방안

### 9.1 예상 리스크

| 리스크 | 영향도 | 발생 가능성 | 대응 방안 |
|--------|-------|-----------|----------|
| DB 연결 풀 고갈 | 높음 | 중간 | HikariCP 설정 조정 |
| Redis 연결 실패 | 높음 | 낮음 | Retry 로직, Circuit Breaker |
| 분산락 타임아웃 | 중간 | 중간 | Lock 대기 시간 조정 |
| 메모리 부족 (OOM) | 높음 | 중간 | JVM Heap 사이즈 조정 |
| Kafka 지연 | 중간 | 낮음 | 파티션 수 조정 |

### 9.2 롤백 계획

```
테스트 중단 조건:
- 에러율 > 50%
- 시스템 무응답 > 30초
- 데이터 정합성 오류 발견

롤백 절차:
1. 테스트 즉시 중단 (Ctrl+C)
2. docker-compose down
3. 데이터 초기화 (필요시)
4. 원인 분석 후 재시도
```

---

## 10. 일정 계획

| 단계 | 작업 내용 | 예상 소요 |
|------|----------|----------|
| 준비 | 환경 구성, 테스트 데이터 준비 | 1시간 |
| Smoke Test | 기본 동작 확인 | 15분 |
| Load Test | 일반 부하 테스트 | 30분 |
| Stress Test | 한계점 테스트 | 1시간 |
| 시나리오 테스트 | 동시성 시나리오 | 1시간 |
| 리소스 테스트 | CPU/Memory 조절 테스트 | 1시간 |
| 결과 정리 | 문서화 | 1시간 |
| **합계** | | **약 6시간** |

---

## 11. 산출물

| 산출물 | 파일명 | 설명 |
|--------|--------|------|
| 테스트 스크립트 | `k6-scripts/*.js` | K6 테스트 스크립트 |
| 테스트 결과 | `부하_테스트_결과.md` | 테스트 결과 보고서 |
| 결과 데이터 | `results/*.json` | Raw 테스트 데이터 |

---

## 12. 승인

| 역할 | 이름 | 승인일 | 서명 |
|------|------|-------|------|
| 작성자 | 백엔드 개발팀 | 2026-02-26 | |
| 검토자 | | | |
| 승인자 | | | |

---

**문서 끝**
